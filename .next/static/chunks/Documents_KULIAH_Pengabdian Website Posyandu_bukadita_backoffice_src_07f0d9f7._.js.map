{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus%20TUF%20Gaming/Documents/KULIAH/Pengabdian%20Website%20Posyandu/bukadita_backoffice/src/lib/api/client.ts"],"sourcesContent":["// Centralized API client for calling the new Express backend\r\n// Ensures Authorization: Bearer <access_token> and JSON headers are set.\r\n\r\nconst RAW_DEFAULT_BASE =\r\n  (typeof process !== \"undefined\" &&\r\n    (process.env.NEXT_PUBLIC_API_URL || process.env.API_BASE_URL)) ||\r\n  \"http://localhost:4000\";\r\n\r\nfunction stripTrailingSlash(u: string) {\r\n  return u.replace(/\\/$/, \"\");\r\n}\r\n\r\nexport function getApiBase(): string {\r\n  // Allow overriding at runtime via window.__API_BASE if needed\r\n  if (typeof window !== \"undefined\") {\r\n    const w = window as typeof window & { __API_BASE?: string };\r\n    if (w.__API_BASE) return stripTrailingSlash(w.__API_BASE);\r\n  }\r\n  return stripTrailingSlash(RAW_DEFAULT_BASE);\r\n}\r\n\r\nexport function getStoredAccessToken(): string | undefined {\r\n  if (typeof window === \"undefined\") return undefined;\r\n  try {\r\n    return (\r\n      sessionStorage.getItem(\"admin_access_token\") ||\r\n      localStorage.getItem(\"admin_access_token\") ||\r\n      undefined ||\r\n      undefined\r\n    );\r\n  } catch {\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport type ApiFetchOptions = Omit<RequestInit, \"body\" | \"headers\"> & {\r\n  asJson?: boolean; // default true: serialize body and set headers\r\n  body?: unknown; // allow plain objects to be JSON-serialized\r\n  headers?: Record<string, string>;\r\n};\r\n\r\nexport async function apiFetch<T = unknown>(\r\n  path: string,\r\n  options: ApiFetchOptions = {}\r\n): Promise<\r\n  | { ok: true; status: number; data: T }\r\n  | { ok: false; status: number; error: string; raw?: unknown }\r\n> {\r\n  const base = getApiBase();\r\n  const url = path.startsWith(\"http\") ? path : `${base}${path}`;\r\n\r\n  const headers: Record<string, string> = {};\r\n  const token = getStoredAccessToken();\r\n  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n  const asJson = options.asJson !== false;\r\n  if (asJson) headers[\"Content-Type\"] = \"application/json\";\r\n\r\n  const init: RequestInit = {\r\n    ...options,\r\n    headers: {\r\n      ...headers,\r\n      ...(options.headers as Record<string, string> | undefined),\r\n    },\r\n    body:\r\n      asJson && options.body && typeof options.body !== \"string\"\r\n        ? JSON.stringify(options.body)\r\n        : (options.body as BodyInit | null | undefined),\r\n    credentials: options.credentials ?? \"include\",\r\n  };\r\n\r\n  try {\r\n    const res = await fetch(url, init);\r\n    const json = await res.json().catch(() => null);\r\n    if (!res.ok) {\r\n      // Prefer 'message' when available; handle boolean error flags gracefully\r\n      let msg: unknown = undefined;\r\n      if (json && typeof json === \"object\") {\r\n        const j = json as Record<string, unknown>;\r\n        msg =\r\n          j.message ||\r\n          (typeof j.error === \"object\" &&\r\n            j.error &&\r\n            (j.error as Record<string, unknown>).message) ||\r\n          (typeof j.error === \"string\" ? j.error : undefined) ||\r\n          j.code ||\r\n          undefined;\r\n      }\r\n      if (!msg) msg = `Request failed (${res.status})`;\r\n      return { ok: false, status: res.status, error: String(msg), raw: json };\r\n    }\r\n    return { ok: true, status: res.status, data: (json?.data ?? json) as T };\r\n  } catch (e: unknown) {\r\n    const message =\r\n      e instanceof Error ? e.message : String(e || \"Network error\");\r\n    return { ok: false, status: 0, error: message };\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,6DAA6D;AAC7D,yEAAyE;;;;;;;;;AAG/D;AADV,MAAM,mBACJ,AAAC,OAAO,0PAAO,KAAK,eAClB,CAAC,6DAAmC,0PAAO,CAAC,GAAG,CAAC,YAAY,KAC9D;AAEF,SAAS,mBAAmB,CAAS;IACnC,OAAO,EAAE,OAAO,CAAC,OAAO;AAC1B;AAEO,SAAS;IACd,8DAA8D;IAC9D,wCAAmC;QACjC,MAAM,IAAI;QACV,IAAI,EAAE,UAAU,EAAE,OAAO,mBAAmB,EAAE,UAAU;IAC1D;IACA,OAAO,mBAAmB;AAC5B;AAEO,SAAS;IACd;;IACA,IAAI;QACF,OACE,eAAe,OAAO,CAAC,yBACvB,aAAa,OAAO,CAAC,yBACrB,aACA;IAEJ,EAAE,UAAM;QACN,OAAO;IACT;AACF;AAQO,eAAe,SACpB,IAAY;QACZ,UAAA,iEAA2B,CAAC;IAK5B,MAAM,OAAO;IACb,MAAM,MAAM,KAAK,UAAU,CAAC,UAAU,OAAO,AAAC,GAAS,OAAP,MAAY,OAAL;IAEvD,MAAM,UAAkC,CAAC;IACzC,MAAM,QAAQ;IACd,IAAI,OAAO,OAAO,CAAC,gBAAgB,GAAG,AAAC,UAAe,OAAN;IAEhD,MAAM,SAAS,QAAQ,MAAM,KAAK;IAClC,IAAI,QAAQ,OAAO,CAAC,eAAe,GAAG;QAYvB;IAVf,MAAM,OAAoB;QACxB,GAAG,OAAO;QACV,SAAS;YACP,GAAG,OAAO;YACV,GAAI,QAAQ,OAAO;QACrB;QACA,MACE,UAAU,QAAQ,IAAI,IAAI,OAAO,QAAQ,IAAI,KAAK,WAC9C,KAAK,SAAS,CAAC,QAAQ,IAAI,IAC1B,QAAQ,IAAI;QACnB,aAAa,CAAA,uBAAA,QAAQ,WAAW,cAAnB,kCAAA,uBAAuB;IACtC;IAEA,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,KAAK;QAC7B,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;QAC1C,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,yEAAyE;YACzE,IAAI,MAAe;YACnB,IAAI,QAAQ,OAAO,SAAS,UAAU;gBACpC,MAAM,IAAI;gBACV,MACE,EAAE,OAAO,IACR,OAAO,EAAE,KAAK,KAAK,YAClB,EAAE,KAAK,IACP,AAAC,EAAE,KAAK,CAA6B,OAAO,IAC9C,CAAC,OAAO,EAAE,KAAK,KAAK,WAAW,EAAE,KAAK,GAAG,SAAS,KAClD,EAAE,IAAI,IACN;YACJ;YACA,IAAI,CAAC,KAAK,MAAM,AAAC,mBAA6B,OAAX,IAAI,MAAM,EAAC;YAC9C,OAAO;gBAAE,IAAI;gBAAO,QAAQ,IAAI,MAAM;gBAAE,OAAO,OAAO;gBAAM,KAAK;YAAK;QACxE;YAC8C;QAA9C,OAAO;YAAE,IAAI;YAAM,QAAQ,IAAI,MAAM;YAAE,MAAO,CAAA,aAAA,iBAAA,2BAAA,KAAM,IAAI,cAAV,wBAAA,aAAc;QAAW;IACzE,EAAE,OAAO,GAAY;QACnB,MAAM,UACJ,aAAa,QAAQ,EAAE,OAAO,GAAG,OAAO,KAAK;QAC/C,OAAO;YAAE,IAAI;YAAO,QAAQ;YAAG,OAAO;QAAQ;IAChD;AACF","debugId":null}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus%20TUF%20Gaming/Documents/KULIAH/Pengabdian%20Website%20Posyandu/bukadita_backoffice/src/lib/api/auth.ts"],"sourcesContent":["import { getApiBase } from \"./client\";\r\n\r\nconst API_BASE = getApiBase();\r\nconst LOGIN_URL = process.env.LOGIN_URL || `${API_BASE}/api/v1/auth/login`;\r\nconst LOGOUT_URL = process.env.LOGOUT_URL || `${API_BASE}/api/v1/auth/logout`;\r\n\r\nexport type BackendProfile = {\r\n  id?: string;\r\n  email?: string;\r\n  full_name?: string;\r\n  phone?: string;\r\n  role?: string;\r\n};\r\n\r\nexport type LoginSuccess = {\r\n  access_token?: string;\r\n  refresh_token?: string;\r\n  profile?: BackendProfile | null;\r\n  userId?: string | null;\r\n  userEmail?: string | null;\r\n  role?: string | null;\r\n};\r\n\r\nexport async function apiLogin(\r\n  email: string,\r\n  password: string\r\n): Promise<\r\n  | { ok: true; status: number; data: LoginSuccess }\r\n  | { ok: false; status: number; error: string }\r\n> {\r\n  try {\r\n    const res = await fetch(LOGIN_URL, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      credentials: \"include\",\r\n      body: JSON.stringify({ email, password }),\r\n    });\r\n\r\n    const json = await res.json().catch(() => null);\r\n\r\n    if (!res.ok) {\r\n      const msg = json?.error || json?.message || `Login gagal (${res.status})`;\r\n      return { ok: false, status: res.status, error: String(msg) };\r\n    }\r\n\r\n    // Normalize different BE response shapes\r\n    const root = json || {};\r\n    const data = root?.data ?? root;\r\n    const access_token =\r\n      data?.access_token ||\r\n      root?.access_token ||\r\n      root?.accessToken ||\r\n      root?.session?.access_token;\r\n    const refresh_token =\r\n      data?.refresh_token ||\r\n      root?.refresh_token ||\r\n      root?.refreshToken ||\r\n      root?.session?.refresh_token;\r\n\r\n    // Extract profile from multiple possible locations\r\n    const userObj = data?.user || root?.user || null;\r\n    const profileFromUser =\r\n      userObj?.profile || root?.user?.profile || data?.user?.profile;\r\n    const profileFromData = data?.profile || root?.profile;\r\n    const profile: BackendProfile | null =\r\n      profileFromUser || profileFromData || null;\r\n\r\n    const userId = userObj?.id || data?.user_id || data?.id || null;\r\n    const userEmail = userObj?.email || data?.email || null;\r\n    const role =\r\n      (profile as BackendProfile | null)?.role ||\r\n      data?.role ||\r\n      userObj?.role ||\r\n      null;\r\n\r\n    return {\r\n      ok: true,\r\n      status: res.status,\r\n      data: {\r\n        access_token,\r\n        refresh_token,\r\n        profile,\r\n        userId,\r\n        userEmail,\r\n        role,\r\n      },\r\n    };\r\n  } catch (e: unknown) {\r\n    const message =\r\n      e instanceof Error\r\n        ? e.message\r\n        : String(e || \"Tidak dapat terhubung ke server login\");\r\n    return { ok: false, status: 0, error: message };\r\n  }\r\n}\r\n\r\nexport async function apiLogout(\r\n  accessToken?: string,\r\n  refreshToken?: string\r\n): Promise<{ ok: boolean; error?: string }> {\r\n  try {\r\n    const headers: Record<string, string> = {\r\n      \"Content-Type\": \"application/json\",\r\n    };\r\n    if (accessToken) headers[\"Authorization\"] = `Bearer ${accessToken}`;\r\n\r\n    const res = await fetch(LOGOUT_URL, {\r\n      method: \"POST\",\r\n      headers,\r\n      credentials: \"include\",\r\n      body: JSON.stringify(refreshToken ? { refresh_token: refreshToken } : {}),\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const json = await res.json().catch(() => null);\r\n      return {\r\n        ok: false,\r\n        error: json?.error || json?.message || `Logout gagal (${res.status})`,\r\n      };\r\n    }\r\n    return { ok: true };\r\n  } catch (e: unknown) {\r\n    const message =\r\n      e instanceof Error\r\n        ? e.message\r\n        : String(e || \"Tidak dapat terhubung ke server logout\");\r\n    return { ok: false, error: message };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus%20TUF%20Gaming/Documents/KULIAH/Pengabdian%20Website%20Posyandu/bukadita_backoffice/src/contexts/AuthContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport type { Profile } from '@/types/profile';\r\nimport { apiLogin, apiLogout, type BackendProfile } from '@/lib/api/auth';\r\n\r\ninterface AuthContextType {\r\n  isAuthenticated: boolean;\r\n  userId: string | null;\r\n  profile: Profile | null;\r\n  login: (email: string, password: string) => Promise<{ ok: boolean; error?: string }>;\r\n  logout: () => void;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [profile, setProfile] = useState<Profile | null>(null);\r\n\r\n  // Initial hydration: check cookie-based session info for quick guard\r\n  useEffect(() => {\r\n    let active = true;\r\n    (async () => {\r\n      try {\r\n        const resp = await fetch('/api/auth/session', { method: 'GET' });\r\n        const json = await resp.json().catch(() => null);\r\n        if (!active) return;\r\n\r\n        // If cookies say authed admin, restore session\r\n        if (json?.authed && (json?.role === 'admin' || json?.role === 'superadmin')) {\r\n          setIsAuthenticated(true);\r\n\r\n          // Also try to restore profile from sessionStorage (for displaying correct name/role)\r\n          if (typeof window !== 'undefined') {\r\n            try {\r\n              const storedProfile = sessionStorage.getItem('admin_profile');\r\n              const storedAccessToken = sessionStorage.getItem('admin_access_token');\r\n              const storedRefreshToken = sessionStorage.getItem('admin_refresh_token');\r\n\r\n              if (storedProfile) {\r\n                const prof = JSON.parse(storedProfile) as Profile;\r\n                setProfile(prof);\r\n                setUserId(prof.id);\r\n                if (storedAccessToken) setAccessToken(storedAccessToken);\r\n                if (storedRefreshToken) setRefreshToken(storedRefreshToken);\r\n              }\r\n            } catch (e) {\r\n              console.warn('Failed to restore profile from sessionStorage:', e);\r\n            }\r\n          }\r\n        }\r\n      } catch { }\r\n      if (active) setIsLoading(false);\r\n    })();\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, []);\r\n\r\n  // Local tokens (kept in memory only; BE should set httpOnly cookies)\r\n  const [accessToken, setAccessToken] = useState<string | undefined>();\r\n  const [refreshToken, setRefreshToken] = useState<string | undefined>();\r\n\r\n  function mapBackendToProfile(p: BackendProfile | null | undefined): Profile | null {\r\n    if (!p || !p.id) return null;\r\n    return {\r\n      id: p.id,\r\n      email: p.email || '',\r\n      full_name: p.full_name || '',\r\n      phone: p.phone || '',\r\n      role: (p.role === 'admin' || p.role === 'superadmin' ? (p.role as 'admin' | 'superadmin') : 'pengguna'),\r\n      created_at: new Date().toISOString(),\r\n      email_confirmed_at: undefined,\r\n      last_sign_in_at: undefined,\r\n    } satisfies Profile;\r\n  }\r\n\r\n  const login = async (email: string, password: string): Promise<{ ok: boolean; error?: string }> => {\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      console.log('üîê Attempting login (backend) for:', email);\r\n\r\n      const res = await apiLogin(email, password);\r\n      if (!res.ok) {\r\n        if (res.status === 401) {\r\n          setIsLoading(false);\r\n          return { ok: false, error: 'Email atau password salah.' };\r\n        }\r\n        setIsLoading(false);\r\n        return { ok: false, error: res.error };\r\n      }\r\n\r\n      const { access_token, refresh_token, profile: beProfile, userId: beUserId, userEmail: beEmail, role: beRole } = res.data;\r\n\r\n      // Handle 202: profile provisioning flow\r\n      if (res.status === 202) {\r\n        // store any tokens in memory briefly\r\n        setAccessToken(access_token);\r\n        setRefreshToken(refresh_token);\r\n        setIsAuthenticated(false);\r\n        setUserId(null);\r\n        setProfile(null);\r\n\r\n        // Auto-retry up to 2 times with small delay\r\n        for (let attempt = 1; attempt <= 2; attempt++) {\r\n          await new Promise((r) => setTimeout(r, 1500));\r\n          const retry = await apiLogin(email, password);\r\n          if (retry.ok && retry.status === 200 && (retry.data.profile?.role === 'admin' || retry.data.profile?.role === 'superadmin')) {\r\n            const retryProf = mapBackendToProfile(retry.data.profile);\r\n            if (retryProf) {\r\n              setAccessToken(retry.data.access_token);\r\n              setRefreshToken(retry.data.refresh_token);\r\n              setProfile(retryProf);\r\n              setUserId(retryProf.id);\r\n              await fetch('/api/auth/session', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ userId: retryProf.id, role: retry.data.profile?.role }),\r\n              });\r\n              setIsAuthenticated(true);\r\n              setIsLoading(false);\r\n              return { ok: true };\r\n            }\r\n          }\r\n        }\r\n        setIsLoading(false);\r\n        return { ok: false, error: 'Profile provisioning in progress ‚Äî retry in a few seconds' };\r\n      }\r\n\r\n      // Build profile from BE data (profile or fallback from user fields)\r\n      const prof = mapBackendToProfile(\r\n        beProfile ?? (beUserId ? { id: beUserId, email: beEmail || undefined, role: beRole || undefined } : null)\r\n      );\r\n\r\n      if (!prof) {\r\n        // No profile returned by BE\r\n        setAccessToken(undefined);\r\n        setRefreshToken(undefined);\r\n        setIsAuthenticated(false);\r\n        setUserId(null);\r\n        setProfile(null);\r\n        setIsLoading(false);\r\n        return { ok: false, error: 'Profile tidak ditemukan. Silakan coba lagi atau hubungi admin.' };\r\n      }\r\n\r\n      if (prof.role !== 'admin' && prof.role !== 'superadmin') {\r\n        // Not admin, revoke on server (best-effort)\r\n        void apiLogout(access_token, refresh_token);\r\n        setAccessToken(undefined);\r\n        setRefreshToken(undefined);\r\n        setIsAuthenticated(false);\r\n        setUserId(null);\r\n        setProfile(null);\r\n        setIsLoading(false);\r\n        return { ok: false, error: 'Akses ditolak. Hanya admin.' };\r\n      }\r\n\r\n      // Persist in memory; assume BE sets httpOnly cookies for session\r\n      setAccessToken(access_token);\r\n      setRefreshToken(refresh_token);\r\n      try {\r\n        if (typeof window !== 'undefined') {\r\n          sessionStorage.setItem('admin_access_token', access_token || '');\r\n          if (refresh_token) sessionStorage.setItem('admin_refresh_token', refresh_token);\r\n          // IMPORTANT: Also persist profile for session restore on refresh\r\n          sessionStorage.setItem('admin_profile', JSON.stringify(prof));\r\n        }\r\n      } catch { }\r\n      setProfile(prof);\r\n      setUserId(prof.id);\r\n\r\n      // Set cookies used by Next middleware for /admin/**\r\n      await fetch('/api/auth/session', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId: prof.id, role: prof.role }),\r\n      });\r\n\r\n      setIsAuthenticated(true);\r\n      setIsLoading(false);\r\n      return { ok: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Login error:', error);\r\n      setIsLoading(false);\r\n      return { ok: false, error: 'Terjadi kesalahan' };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      console.log('üö™ Logging out...');\r\n\r\n      // Ask backend to invalidate session\r\n      await apiLogout(accessToken, refreshToken);\r\n\r\n      // Clear admin cookies used by middleware\r\n      await fetch('/api/auth/logout', { method: 'POST' });\r\n\r\n      // Clear local storage\r\n      setIsAuthenticated(false);\r\n      setUserId(null);\r\n      setProfile(null);\r\n      setAccessToken(undefined);\r\n      setRefreshToken(undefined);\r\n      try {\r\n        if (typeof window !== 'undefined') {\r\n          sessionStorage.removeItem('admin_access_token');\r\n          sessionStorage.removeItem('admin_refresh_token');\r\n          sessionStorage.removeItem('admin_profile'); // Also clear profile\r\n        }\r\n      } catch { }\r\n      console.log('‚úÖ Logout successful');\r\n    } catch (error) {\r\n      console.error('‚ùå Logout error:', error);\r\n      // Still clear local state even if backend logout fails\r\n      setIsAuthenticated(false);\r\n      setUserId(null);\r\n      setProfile(null);\r\n      setAccessToken(undefined);\r\n      setRefreshToken(undefined);\r\n      try {\r\n        if (typeof window !== 'undefined') {\r\n          sessionStorage.removeItem('admin_access_token');\r\n          sessionStorage.removeItem('admin_refresh_token');\r\n          sessionStorage.removeItem('admin_profile');\r\n        }\r\n      } catch { }\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    isAuthenticated,\r\n    userId,\r\n    profile,\r\n    login,\r\n    logout,\r\n    isLoading,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AAEA;;;AAJA;;;AAeA,MAAM,4BAAc,IAAA,6PAAa,EAA8B;AAExD,SAAS,aAAa,KAAqC;QAArC,EAAE,QAAQ,EAA2B,GAArC;;IAC3B,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,wPAAQ,EAAC;IACvD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wPAAQ,EAAC;IAC3C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,wPAAQ,EAAgB;IACpD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,wPAAQ,EAAiB;IAEvD,qEAAqE;IACrE,IAAA,yPAAS;kCAAC;YACR,IAAI,SAAS;YACb;0CAAC;oBACC,IAAI;wBACF,MAAM,OAAO,MAAM,MAAM,qBAAqB;4BAAE,QAAQ;wBAAM;wBAC9D,MAAM,OAAO,MAAM,KAAK,IAAI,GAAG,KAAK;sDAAC,IAAM;;wBAC3C,IAAI,CAAC,QAAQ;wBAEb,+CAA+C;wBAC/C,IAAI,CAAA,iBAAA,2BAAA,KAAM,MAAM,KAAI,CAAC,AAPzB,CAOyB,iBAAA,2BAAA,KAAM,IAAI,AAwBlC,MAxBuC,WAAW,CAAA,iBAAA,2BAAA,KAAM,IAAI,MAAK,YAAY,GAAG;4BAC3E,mBAAmB;4BAEnB,qFAAqF;4BACrF,wCAAmC;gCACjC,IAAI;oCACF,MAAM,gBAAgB,eAAe,OAAO,CAAC;oCAC7C,MAAM,oBAAoB,eAAe,OAAO,CAAC;oCACjD,MAAM,qBAAqB,eAAe,OAAO,CAAC;oCAElD,IAAI,eAAe;wCACjB,MAAM,OAAO,KAAK,KAAK,CAAC;wCACxB,WAAW;wCACX,UAAU,KAAK,EAAE;wCACjB,IAAI,mBAAmB,eAAe;wCACtC,IAAI,oBAAoB,gBAAgB;oCAC1C;gCACF,EAAE,OAAO,GAAG;oCACV,QAAQ,IAAI,CAAC,kDAAkD;gCACjE;4BACF;wBACF;oBACF,EAAE,UAAM,CAAE;oBACV,IAAI,QAAQ,aAAa;gBAC3B;;YACA;0CAAO;oBACL,SAAS;gBACX;;QACF;iCAAG,EAAE;IAEL,qEAAqE;IACrE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,wPAAQ;IAC9C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,wPAAQ;IAEhD,SAAS,oBAAoB,CAAoC;QAC/D,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,OAAO;QACxB,OAAO;YACL,IAAI,EAAE,EAAE;YACR,OAAO,EAAE,KAAK,IAAI;YAClB,WAAW,EAAE,SAAS,IAAI;YAC1B,OAAO,EAAE,KAAK,IAAI;YAClB,MAAO,EAAE,IAAI,KAAK,WAAW,EAAE,IAAI,KAAK,eAAgB,EAAE,IAAI,GAA8B;YAC5F,YAAY,IAAI,OAAO,WAAW;YAClC,oBAAoB;YACpB,iBAAiB;QACnB;IACF;IAEA,MAAM,QAAQ,OAAO,OAAe;QAClC,aAAa;QAEb,IAAI;YACF,QAAQ,GAAG,CAAC,sCAAsC;YAElD,MAAM,MAAM,MAAM,IAAA,uNAAQ,EAAC,OAAO;YAClC,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,IAAI,IAAI,MAAM,KAAK,KAAK;oBACtB,aAAa;oBACb,OAAO;wBAAE,IAAI;wBAAO,OAAO;oBAA6B;gBAC1D;gBACA,aAAa;gBACb,OAAO;oBAAE,IAAI;oBAAO,OAAO,IAAI,KAAK;gBAAC;YACvC;YAEA,MAAM,EAAE,YAAY,EAAE,aAAa,EAAE,SAAS,SAAS,EAAE,QAAQ,QAAQ,EAAE,WAAW,OAAO,EAAE,MAAM,MAAM,EAAE,GAAG,IAAI,IAAI;YAExH,wCAAwC;YACxC,IAAI,IAAI,MAAM,KAAK,KAAK;gBACtB,qCAAqC;gBACrC,eAAe;gBACf,gBAAgB;gBAChB,mBAAmB;gBACnB,UAAU;gBACV,WAAW;gBAEX,4CAA4C;gBAC5C,IAAK,IAAI,UAAU,GAAG,WAAW,GAAG,UAAW;wBAGJ,qBAAwC;oBAFjF,MAAM,IAAI,QAAQ,CAAC,IAAM,WAAW,GAAG;oBACvC,MAAM,QAAQ,MAAM,IAAA,uNAAQ,EAAC,OAAO;oBACpC,IAAI,MAAM,EAAE,IAAI,MAAM,MAAM,KAAK,OAAO,CAAC,EAAA,sBAAA,MAAM,IAAI,CAAC,OAAO,cAAlB,0CAAA,oBAAoB,IAAI,MAAK,WAAW,EAAA,uBAAA,MAAM,IAAI,CAAC,OAAO,cAAlB,2CAAA,qBAAoB,IAAI,MAAK,YAAY,GAAG;wBAC3H,MAAM,YAAY,oBAAoB,MAAM,IAAI,CAAC,OAAO;wBACxD,IAAI,WAAW;gCAQwC;4BAPrD,eAAe,MAAM,IAAI,CAAC,YAAY;4BACtC,gBAAgB,MAAM,IAAI,CAAC,aAAa;4BACxC,WAAW;4BACX,UAAU,UAAU,EAAE;4BACtB,MAAM,MAAM,qBAAqB;gCAC/B,QAAQ;gCACR,SAAS;oCAAE,gBAAgB;gCAAmB;gCAC9C,MAAM,KAAK,SAAS,CAAC;oCAAE,QAAQ,UAAU,EAAE;oCAAE,IAAI,GAAE,uBAAA,MAAM,IAAI,CAAC,OAAO,cAAlB,2CAAA,qBAAoB,IAAI;gCAAC;4BAC9E;4BACA,mBAAmB;4BACnB,aAAa;4BACb,OAAO;gCAAE,IAAI;4BAAK;wBACpB;oBACF;gBACF;gBACA,aAAa;gBACb,OAAO;oBAAE,IAAI;oBAAO,OAAO;gBAA4D;YACzF;YAEA,oEAAoE;YACpE,MAAM,OAAO,oBACX,sBAAA,uBAAA,YAAc,WAAW;gBAAE,IAAI;gBAAU,OAAO,WAAW;gBAAW,MAAM,UAAU;YAAU,IAAI;YAGtG,IAAI,CAAC,MAAM;gBACT,4BAA4B;gBAC5B,eAAe;gBACf,gBAAgB;gBAChB,mBAAmB;gBACnB,UAAU;gBACV,WAAW;gBACX,aAAa;gBACb,OAAO;oBAAE,IAAI;oBAAO,OAAO;gBAAiE;YAC9F;YAEA,IAAI,KAAK,IAAI,KAAK,WAAW,KAAK,IAAI,KAAK,cAAc;gBACvD,4CAA4C;gBAC5C,KAAK,IAAA,wNAAS,EAAC,cAAc;gBAC7B,eAAe;gBACf,gBAAgB;gBAChB,mBAAmB;gBACnB,UAAU;gBACV,WAAW;gBACX,aAAa;gBACb,OAAO;oBAAE,IAAI;oBAAO,OAAO;gBAA8B;YAC3D;YAEA,iEAAiE;YACjE,eAAe;YACf,gBAAgB;YAChB,IAAI;gBACF,wCAAmC;oBACjC,eAAe,OAAO,CAAC,sBAAsB,gBAAgB;oBAC7D,IAAI,eAAe,eAAe,OAAO,CAAC,uBAAuB;oBACjE,iEAAiE;oBACjE,eAAe,OAAO,CAAC,iBAAiB,KAAK,SAAS,CAAC;gBACzD;YACF,EAAE,UAAM,CAAE;YACV,WAAW;YACX,UAAU,KAAK,EAAE;YAEjB,oDAAoD;YACpD,MAAM,MAAM,qBAAqB;gBAC/B,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,QAAQ,KAAK,EAAE;oBAAE,MAAM,KAAK,IAAI;gBAAC;YAC1D;YAEA,mBAAmB;YACnB,aAAa;YACb,OAAO;gBAAE,IAAI;YAAK;QACpB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;YAChC,aAAa;YACb,OAAO;gBAAE,IAAI;gBAAO,OAAO;YAAoB;QACjD;IACF;IAEA,MAAM,SAAS;QACb,IAAI;YACF,QAAQ,GAAG,CAAC;YAEZ,oCAAoC;YACpC,MAAM,IAAA,wNAAS,EAAC,aAAa;YAE7B,yCAAyC;YACzC,MAAM,MAAM,oBAAoB;gBAAE,QAAQ;YAAO;YAEjD,sBAAsB;YACtB,mBAAmB;YACnB,UAAU;YACV,WAAW;YACX,eAAe;YACf,gBAAgB;YAChB,IAAI;gBACF,wCAAmC;oBACjC,eAAe,UAAU,CAAC;oBAC1B,eAAe,UAAU,CAAC;oBAC1B,eAAe,UAAU,CAAC,kBAAkB,qBAAqB;gBACnE;YACF,EAAE,UAAM,CAAE;YACV,QAAQ,GAAG,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,mBAAmB;YACjC,uDAAuD;YACvD,mBAAmB;YACnB,UAAU;YACV,WAAW;YACX,eAAe;YACf,gBAAgB;YAChB,IAAI;gBACF,wCAAmC;oBACjC,eAAe,UAAU,CAAC;oBAC1B,eAAe,UAAU,CAAC;oBAC1B,eAAe,UAAU,CAAC;gBAC5B;YACF,EAAE,UAAM,CAAE;QACZ;IACF;IAEA,MAAM,QAAQ;QACZ;QACA;QACA;QACA;QACA;QACA;IACF;IAEA,qBACE,4QAAC,YAAY,QAAQ;QAAC,OAAO;kBAC1B;;;;;;AAGP;GAxOgB;KAAA;AA0OT,SAAS;;IACd,MAAM,UAAU,IAAA,0PAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB","debugId":null}},
    {"offset": {"line": 501, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus%20TUF%20Gaming/Documents/KULIAH/Pengabdian%20Website%20Posyandu/bukadita_backoffice/src/lib/api/admin.ts"],"sourcesContent":["import { apiFetch } from \"./client\";\r\n\r\n// Types\r\nexport type Role = \"pengguna\" | \"admin\" | \"superadmin\";\r\n\r\nexport interface AdminUser {\r\n  id: string;\r\n  full_name: string;\r\n  phone?: string;\r\n  email: string;\r\n  role: Role;\r\n  created_at: string;\r\n  email_confirmed_at?: string | null;\r\n  last_sign_in_at?: string | null;\r\n}\r\n\r\nexport interface PaginationMeta {\r\n  currentPage: number;\r\n  totalPages: number;\r\n  totalCount: number;\r\n  nextPage?: number | null;\r\n  prevPage?: number | null;\r\n}\r\n\r\nexport interface VisibilityRules {\r\n  caller_role: Role;\r\n  allowed_roles: Role[];\r\n  excluded_self: boolean;\r\n}\r\n\r\nexport interface UsersListResponse {\r\n  items: AdminUser[];\r\n  pagination: PaginationMeta;\r\n  visibility: VisibilityRules; // Backend uses 'visibility' not 'visibility_rules'\r\n  filters?: {\r\n    search?: string;\r\n    role?: string;\r\n  };\r\n}\r\n\r\nexport const adminUsersApi = {\r\n  list: async (\r\n    params: {\r\n      page?: number;\r\n      limit?: number;\r\n      role?: string;\r\n      search?: string;\r\n    } = {}\r\n  ) => {\r\n    const query = new URLSearchParams();\r\n    if (params.page) query.set(\"page\", String(params.page));\r\n    if (params.limit) query.set(\"limit\", String(params.limit));\r\n    if (params.role) query.set(\"role\", String(params.role));\r\n    if (params.search) query.set(\"search\", String(params.search));\r\n    return apiFetch<UsersListResponse>(\r\n      `/api/v1/admin/users?${query.toString()}`,\r\n      {\r\n        method: \"GET\",\r\n      }\r\n    );\r\n  },\r\n\r\n  create: async (payload: {\r\n    email: string;\r\n    password: string;\r\n    full_name: string;\r\n    phone?: string;\r\n    role: \"pengguna\" | \"admin\";\r\n  }) => {\r\n    return apiFetch<AdminUser>(`/api/v1/admin/users`, {\r\n      method: \"POST\",\r\n      body: payload,\r\n    });\r\n  },\r\n\r\n  get: async (id: string) => {\r\n    return apiFetch<AdminUser>(`/api/v1/admin/users/${id}`, { method: \"GET\" });\r\n  },\r\n\r\n  update: async (\r\n    id: string,\r\n    payload: Partial<Pick<AdminUser, \"full_name\" | \"phone\" | \"email\">>\r\n  ) => {\r\n    return apiFetch<AdminUser>(`/api/v1/admin/users/${id}`, {\r\n      method: \"PUT\",\r\n      body: payload,\r\n    });\r\n  },\r\n\r\n  updateRole: async (id: string, role: \"pengguna\" | \"admin\") => {\r\n    return apiFetch<AdminUser>(`/api/v1/admin/users/${id}/role`, {\r\n      method: \"PUT\",\r\n      body: { role },\r\n    });\r\n  },\r\n\r\n  remove: async (id: string, mode?: \"soft\" | \"hard\") => {\r\n    const query = new URLSearchParams();\r\n    if (mode && mode === \"soft\") query.set(\"mode\", \"soft\");\r\n    return apiFetch<{ ok: boolean }>(\r\n      `/api/v1/admin/users/${id}${\r\n        query.toString() ? `?${query.toString()}` : \"\"\r\n      }`,\r\n      { method: \"DELETE\" }\r\n    );\r\n  },\r\n};\r\n\r\nexport const adminDashboardApi = {\r\n  stats: async () =>\r\n    apiFetch(`/api/v1/admin/dashboard/stats`, { method: \"GET\" }),\r\n};\r\n\r\nexport const adminQuizResultsApi = {\r\n  list: async (\r\n    params: {\r\n      page?: number;\r\n      limit?: number;\r\n      quiz_id?: string;\r\n      user_id?: string;\r\n      module_id?: string;\r\n    } = {}\r\n  ) => {\r\n    const query = new URLSearchParams();\r\n    if (params.page) query.set(\"page\", String(params.page));\r\n    if (params.limit) query.set(\"limit\", String(params.limit));\r\n    if (params.quiz_id) query.set(\"quiz_id\", String(params.quiz_id));\r\n    if (params.user_id) query.set(\"user_id\", String(params.user_id));\r\n    if (params.module_id) query.set(\"module_id\", String(params.module_id));\r\n    return apiFetch(`/api/v1/admin/quiz-attempts?${query.toString()}`, {\r\n      method: \"GET\",\r\n    });\r\n  },\r\n\r\n  getAttemptDetail: async (attemptId: string | number) => {\r\n    return apiFetch(\r\n      `/api/v1/admin/quiz-attempts/${encodeURIComponent(String(attemptId))}`,\r\n      {\r\n        method: \"GET\",\r\n      }\r\n    );\r\n  },\r\n};\r\n\r\n// ================\r\n// Materials (admin)\r\n// ================\r\n\r\nexport interface MaterialRecord {\r\n  id: string | number;\r\n  title: string;\r\n  content: string;\r\n  slug?: string;\r\n  published?: boolean;\r\n  module_id?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface MaterialsListResponse {\r\n  items?: MaterialRecord[];\r\n  data?: MaterialRecord[];\r\n  pagination?: PaginationMeta;\r\n}\r\n\r\nexport const adminMaterialsApi = {\r\n  list: async (params: {\r\n    module_id: string | number;\r\n    page?: number;\r\n    limit?: number;\r\n    include_drafts?: boolean; // Admin-specific parameter (kept for compatibility)\r\n  }) => {\r\n    const query = new URLSearchParams();\r\n    if (params.module_id) query.set(\"module_id\", String(params.module_id));\r\n    if (params.page) query.set(\"page\", String(params.page));\r\n    if (params.limit) query.set(\"limit\", String(params.limit));\r\n\r\n    // Use ADMIN endpoint as suggested by backend team\r\n    // This endpoint returns ALL materials including unpublished (published=false)\r\n    const endpoint = `/api/v1/admin/sub-materis?${query.toString()}`;\r\n\r\n    return apiFetch<MaterialsListResponse>(endpoint, {\r\n      method: \"GET\",\r\n      cache: \"no-store\",\r\n    });\r\n  },\r\n\r\n  // Create at root (requires module_id in body)\r\n  createRoot: (payload: {\r\n    title: string;\r\n    content: string;\r\n    module_id: string;\r\n    slug?: string;\r\n    published?: boolean;\r\n  }) => apiFetch(`/api/v1/materials`, { method: \"POST\", body: payload }),\r\n\r\n  // Nested create: module_id inferred from URL (resilient path)\r\n  // Resilient nested create: try public path first, then admin-scoped\r\n  createNested: async (\r\n    moduleId: string | number,\r\n    payload: {\r\n      title: string;\r\n      content: string;\r\n      slug?: string;\r\n      published?: boolean;\r\n    }\r\n  ) => {\r\n    const pathAdmin = `/api/v1/admin/modules/${encodeURIComponent(\r\n      String(moduleId)\r\n    )}/materials`;\r\n    const pathPublic = `/api/v1/modules/${encodeURIComponent(\r\n      String(moduleId)\r\n    )}/materials`;\r\n    const first = await apiFetch(pathPublic, { method: \"POST\", body: payload });\r\n    if (first.ok || (first.status !== 404 && first.status !== 405))\r\n      return first;\r\n    return apiFetch(pathAdmin, { method: \"POST\", body: payload });\r\n  },\r\n\r\n  update: (\r\n    id: string | number,\r\n    payload: {\r\n      title?: string;\r\n      content?: string;\r\n      slug?: string;\r\n      published?: boolean;\r\n      module_id?: string; // allow moving material between modules\r\n    }\r\n  ) =>\r\n    apiFetch(`/api/v1/materials/${encodeURIComponent(String(id))}`, {\r\n      method: \"PUT\",\r\n      body: payload,\r\n    }),\r\n\r\n  remove: (id: string | number) =>\r\n    apiFetch(`/api/v1/materials/${encodeURIComponent(String(id))}`, {\r\n      method: \"DELETE\",\r\n    }),\r\n};\r\n\r\nexport const adminSchedulesApi = {\r\n  create: (payload: {\r\n    title: string;\r\n    description?: string;\r\n    location?: string;\r\n    date: string;\r\n  }) => apiFetch(`/api/v1/schedules`, { method: \"POST\", body: payload }),\r\n  update: (\r\n    id: string | number,\r\n    payload: {\r\n      title?: string;\r\n      description?: string;\r\n      location?: string;\r\n      date?: string;\r\n    }\r\n  ) => apiFetch(`/api/v1/schedules/${id}`, { method: \"PUT\", body: payload }),\r\n  remove: (id: string | number) =>\r\n    apiFetch(`/api/v1/schedules/${id}`, { method: \"DELETE\" }),\r\n};\r\n\r\n// =====================\r\n// Modules (dynamic) API\r\n// =====================\r\n\r\nexport interface ModuleItem {\r\n  id: string | number; // Could be slug or numeric ID depending on backend\r\n  title: string;\r\n  slug?: string;\r\n  description?: string;\r\n  published?: boolean;\r\n  materiCount?: number;\r\n  quizCount?: number;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface ModulesListResponse {\r\n  items?: ModuleItem[];\r\n  data?: ModuleItem[];\r\n  pagination?: PaginationMeta;\r\n}\r\n\r\n// Resilient modules API: try admin-scoped path first, then fallback\r\nconst MODULES_PRIMARY_PATH = \"/api/v1/admin/modules\" as const;\r\nconst MODULES_FALLBACK_PATH = \"/api/v1/modules\" as const;\r\n\r\nexport const adminModulesApi = {\r\n  list: async () => {\r\n    const first = await apiFetch<ModulesListResponse>(\r\n      `${MODULES_PRIMARY_PATH}`,\r\n      { method: \"GET\" }\r\n    );\r\n    if (first.ok || (first.status !== 404 && first.status !== 405))\r\n      return first;\r\n    return apiFetch<ModulesListResponse>(`${MODULES_FALLBACK_PATH}`, {\r\n      method: \"GET\",\r\n    });\r\n  },\r\n  create: async (payload: {\r\n    title: string;\r\n    description?: string;\r\n    published?: boolean;\r\n  }) => {\r\n    const first = await apiFetch<ModuleItem>(`${MODULES_PRIMARY_PATH}`, {\r\n      method: \"POST\",\r\n      body: payload,\r\n    });\r\n    if (first.ok || (first.status !== 404 && first.status !== 405))\r\n      return first;\r\n    return apiFetch<ModuleItem>(`${MODULES_FALLBACK_PATH}`, {\r\n      method: \"POST\",\r\n      body: payload,\r\n    });\r\n  },\r\n  update: async (\r\n    id: string | number,\r\n    payload: { title?: string; description?: string; published?: boolean }\r\n  ) => {\r\n    const path1 = `${MODULES_PRIMARY_PATH}/${encodeURIComponent(String(id))}`;\r\n    const path2 = `${MODULES_FALLBACK_PATH}/${encodeURIComponent(String(id))}`;\r\n    const first = await apiFetch<ModuleItem>(path1, {\r\n      method: \"PUT\",\r\n      body: payload,\r\n    });\r\n    if (first.ok || (first.status !== 404 && first.status !== 405))\r\n      return first;\r\n    return apiFetch<ModuleItem>(path2, { method: \"PUT\", body: payload });\r\n  },\r\n  remove: async (id: string | number) => {\r\n    const path1 = `${MODULES_PRIMARY_PATH}/${encodeURIComponent(String(id))}`;\r\n    const path2 = `${MODULES_FALLBACK_PATH}/${encodeURIComponent(String(id))}`;\r\n    const first = await apiFetch<{ ok: boolean }>(path1, { method: \"DELETE\" });\r\n    if (first.ok || (first.status !== 404 && first.status !== 405))\r\n      return first;\r\n    return apiFetch<{ ok: boolean }>(path2, { method: \"DELETE\" });\r\n  },\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAwCO,MAAM,gBAAgB;IAC3B,MAAM;YACJ,0EAKI,CAAC;QAEL,MAAM,QAAQ,IAAI;QAClB,IAAI,OAAO,IAAI,EAAE,MAAM,GAAG,CAAC,QAAQ,OAAO,OAAO,IAAI;QACrD,IAAI,OAAO,KAAK,EAAE,MAAM,GAAG,CAAC,SAAS,OAAO,OAAO,KAAK;QACxD,IAAI,OAAO,IAAI,EAAE,MAAM,GAAG,CAAC,QAAQ,OAAO,OAAO,IAAI;QACrD,IAAI,OAAO,MAAM,EAAE,MAAM,GAAG,CAAC,UAAU,OAAO,OAAO,MAAM;QAC3D,OAAO,IAAA,yNAAQ,EACb,AAAC,uBAAuC,OAAjB,MAAM,QAAQ,KACrC;YACE,QAAQ;QACV;IAEJ;IAEA,QAAQ,OAAO;QAOb,OAAO,IAAA,yNAAQ,EAAa,uBAAsB;YAChD,QAAQ;YACR,MAAM;QACR;IACF;IAEA,KAAK,OAAO;QACV,OAAO,IAAA,yNAAQ,EAAY,AAAC,uBAAyB,OAAH,KAAM;YAAE,QAAQ;QAAM;IAC1E;IAEA,QAAQ,OACN,IACA;QAEA,OAAO,IAAA,yNAAQ,EAAY,AAAC,uBAAyB,OAAH,KAAM;YACtD,QAAQ;YACR,MAAM;QACR;IACF;IAEA,YAAY,OAAO,IAAY;QAC7B,OAAO,IAAA,yNAAQ,EAAY,AAAC,uBAAyB,OAAH,IAAG,UAAQ;YAC3D,QAAQ;YACR,MAAM;gBAAE;YAAK;QACf;IACF;IAEA,QAAQ,OAAO,IAAY;QACzB,MAAM,QAAQ,IAAI;QAClB,IAAI,QAAQ,SAAS,QAAQ,MAAM,GAAG,CAAC,QAAQ;QAC/C,OAAO,IAAA,yNAAQ,EACb,AAAC,uBACC,OADqB,IAEtB,OADC,MAAM,QAAQ,KAAK,AAAC,IAAoB,OAAjB,MAAM,QAAQ,MAAO,KAE9C;YAAE,QAAQ;QAAS;IAEvB;AACF;AAEO,MAAM,oBAAoB;IAC/B,OAAO,UACL,IAAA,yNAAQ,EAAE,iCAAgC;YAAE,QAAQ;QAAM;AAC9D;AAEO,MAAM,sBAAsB;IACjC,MAAM;YACJ,0EAMI,CAAC;QAEL,MAAM,QAAQ,IAAI;QAClB,IAAI,OAAO,IAAI,EAAE,MAAM,GAAG,CAAC,QAAQ,OAAO,OAAO,IAAI;QACrD,IAAI,OAAO,KAAK,EAAE,MAAM,GAAG,CAAC,SAAS,OAAO,OAAO,KAAK;QACxD,IAAI,OAAO,OAAO,EAAE,MAAM,GAAG,CAAC,WAAW,OAAO,OAAO,OAAO;QAC9D,IAAI,OAAO,OAAO,EAAE,MAAM,GAAG,CAAC,WAAW,OAAO,OAAO,OAAO;QAC9D,IAAI,OAAO,SAAS,EAAE,MAAM,GAAG,CAAC,aAAa,OAAO,OAAO,SAAS;QACpE,OAAO,IAAA,yNAAQ,EAAC,AAAC,+BAA+C,OAAjB,MAAM,QAAQ,KAAM;YACjE,QAAQ;QACV;IACF;IAEA,kBAAkB,OAAO;QACvB,OAAO,IAAA,yNAAQ,EACb,AAAC,+BAAoE,OAAtC,mBAAmB,OAAO,cACzD;YACE,QAAQ;QACV;IAEJ;AACF;AAuBO,MAAM,oBAAoB;IAC/B,MAAM,OAAO;QAMX,MAAM,QAAQ,IAAI;QAClB,IAAI,OAAO,SAAS,EAAE,MAAM,GAAG,CAAC,aAAa,OAAO,OAAO,SAAS;QACpE,IAAI,OAAO,IAAI,EAAE,MAAM,GAAG,CAAC,QAAQ,OAAO,OAAO,IAAI;QACrD,IAAI,OAAO,KAAK,EAAE,MAAM,GAAG,CAAC,SAAS,OAAO,OAAO,KAAK;QAExD,kDAAkD;QAClD,8EAA8E;QAC9E,MAAM,WAAW,AAAC,6BAA6C,OAAjB,MAAM,QAAQ;QAE5D,OAAO,IAAA,yNAAQ,EAAwB,UAAU;YAC/C,QAAQ;YACR,OAAO;QACT;IACF;IAEA,8CAA8C;IAC9C,YAAY,CAAC,UAMP,IAAA,yNAAQ,EAAE,qBAAoB;YAAE,QAAQ;YAAQ,MAAM;QAAQ;IAEpE,8DAA8D;IAC9D,oEAAoE;IACpE,cAAc,OACZ,UACA;QAOA,MAAM,YAAY,AAAC,yBAEjB,OAFyC,mBACzC,OAAO,YACP;QACF,MAAM,aAAa,AAAC,mBAElB,OAFoC,mBACpC,OAAO,YACP;QACF,MAAM,QAAQ,MAAM,IAAA,yNAAQ,EAAC,YAAY;YAAE,QAAQ;YAAQ,MAAM;QAAQ;QACzE,IAAI,MAAM,EAAE,IAAK,MAAM,MAAM,KAAK,OAAO,MAAM,MAAM,KAAK,KACxD,OAAO;QACT,OAAO,IAAA,yNAAQ,EAAC,WAAW;YAAE,QAAQ;YAAQ,MAAM;QAAQ;IAC7D;IAEA,QAAQ,CACN,IACA,UAQA,IAAA,yNAAQ,EAAC,AAAC,qBAAmD,OAA/B,mBAAmB,OAAO,OAAQ;YAC9D,QAAQ;YACR,MAAM;QACR;IAEF,QAAQ,CAAC,KACP,IAAA,yNAAQ,EAAC,AAAC,qBAAmD,OAA/B,mBAAmB,OAAO,OAAQ;YAC9D,QAAQ;QACV;AACJ;AAEO,MAAM,oBAAoB;IAC/B,QAAQ,CAAC,UAKH,IAAA,yNAAQ,EAAE,qBAAoB;YAAE,QAAQ;YAAQ,MAAM;QAAQ;IACpE,QAAQ,CACN,IACA,UAMG,IAAA,yNAAQ,EAAC,AAAC,qBAAuB,OAAH,KAAM;YAAE,QAAQ;YAAO,MAAM;QAAQ;IACxE,QAAQ,CAAC,KACP,IAAA,yNAAQ,EAAC,AAAC,qBAAuB,OAAH,KAAM;YAAE,QAAQ;QAAS;AAC3D;AAuBA,oEAAoE;AACpE,MAAM,uBAAuB;AAC7B,MAAM,wBAAwB;AAEvB,MAAM,kBAAkB;IAC7B,MAAM;QACJ,MAAM,QAAQ,MAAM,IAAA,yNAAQ,EAC1B,AAAC,GAAuB,OAArB,uBACH;YAAE,QAAQ;QAAM;QAElB,IAAI,MAAM,EAAE,IAAK,MAAM,MAAM,KAAK,OAAO,MAAM,MAAM,KAAK,KACxD,OAAO;QACT,OAAO,IAAA,yNAAQ,EAAsB,AAAC,GAAwB,OAAtB,wBAAyB;YAC/D,QAAQ;QACV;IACF;IACA,QAAQ,OAAO;QAKb,MAAM,QAAQ,MAAM,IAAA,yNAAQ,EAAa,AAAC,GAAuB,OAArB,uBAAwB;YAClE,QAAQ;YACR,MAAM;QACR;QACA,IAAI,MAAM,EAAE,IAAK,MAAM,MAAM,KAAK,OAAO,MAAM,MAAM,KAAK,KACxD,OAAO;QACT,OAAO,IAAA,yNAAQ,EAAa,AAAC,GAAwB,OAAtB,wBAAyB;YACtD,QAAQ;YACR,MAAM;QACR;IACF;IACA,QAAQ,OACN,IACA;QAEA,MAAM,QAAQ,AAAC,GAA0B,OAAxB,sBAAqB,KAAkC,OAA/B,mBAAmB,OAAO;QACnE,MAAM,QAAQ,AAAC,GAA2B,OAAzB,uBAAsB,KAAkC,OAA/B,mBAAmB,OAAO;QACpE,MAAM,QAAQ,MAAM,IAAA,yNAAQ,EAAa,OAAO;YAC9C,QAAQ;YACR,MAAM;QACR;QACA,IAAI,MAAM,EAAE,IAAK,MAAM,MAAM,KAAK,OAAO,MAAM,MAAM,KAAK,KACxD,OAAO;QACT,OAAO,IAAA,yNAAQ,EAAa,OAAO;YAAE,QAAQ;YAAO,MAAM;QAAQ;IACpE;IACA,QAAQ,OAAO;QACb,MAAM,QAAQ,AAAC,GAA0B,OAAxB,sBAAqB,KAAkC,OAA/B,mBAAmB,OAAO;QACnE,MAAM,QAAQ,AAAC,GAA2B,OAAzB,uBAAsB,KAAkC,OAA/B,mBAAmB,OAAO;QACpE,MAAM,QAAQ,MAAM,IAAA,yNAAQ,EAAkB,OAAO;YAAE,QAAQ;QAAS;QACxE,IAAI,MAAM,EAAE,IAAK,MAAM,MAAM,KAAK,OAAO,MAAM,MAAM,KAAK,KACxD,OAAO;QACT,OAAO,IAAA,yNAAQ,EAAkB,OAAO;YAAE,QAAQ;QAAS;IAC7D;AACF","debugId":null}},
    {"offset": {"line": 697, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus%20TUF%20Gaming/Documents/KULIAH/Pengabdian%20Website%20Posyandu/bukadita_backoffice/src/components/admin/AdminShell.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport { useState, ReactNode, useEffect } from \"react\";\r\nimport Swal from \"sweetalert2\";\r\nimport {\r\n  Users,\r\n  ChartPie,\r\n  BookOpen,\r\n  ListChecks,\r\n  ChevronDown,\r\n  ChevronRight,\r\n  LogOut,\r\n  User,\r\n  Folder,\r\n  TrendingUp\r\n} from \"lucide-react\";\r\n// Removed unused specific category icons due to dynamic modules\r\nimport { AuthProvider, useAuth } from \"@/contexts/AuthContext\";\r\nimport { adminModulesApi } from \"@/lib/api/admin\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ninterface AdminShellProps {\r\n  children: ReactNode;\r\n}\r\n\r\nfunction AdminHeader() {\r\n  const { profile, isLoading, logout } = useAuth();\r\n\r\n  const displayName = profile?.full_name || profile?.email || \"Admin\";\r\n  const roleLabel = profile?.role === \"superadmin\" ? \"Superadmin\" : profile?.role === \"admin\" ? \"Admin\" : null;\r\n\r\n  const router = useRouter();\r\n  return (\r\n    <header className=\"fixed top-0 left-80 right-0 h-20 bg-gradient-to-l from-[#27548A] to-[#1C3C6D] shadow-sm z-30\">\r\n      <div className=\"h-full px-6 flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-lg font-semibold text-white\">Dashboard Admin</h1>\r\n          <p className=\"text-xs text-slate-300\">Bukadita - Buku Kader Digital Posyandu Kopelma Darussalam</p>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-5\">\r\n          <div>\r\n            <span className=\"text-sm text-slate-300\">{isLoading ? \"Memuat..\" : displayName}</span>\r\n            {roleLabel && (\r\n              <span className=\"ml-2 inline-flex items-center rounded-full bg-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-white\">\r\n                {roleLabel}\r\n                <User className=\"inline-block w-5 h-5 text-slate-300 ml-2\" />\r\n              </span>\r\n            )}\r\n          </div>\r\n          <button\r\n            onClick={async () => {\r\n              const result = await Swal.fire({\r\n                title: 'Keluar dari Admin?',\r\n                text: 'Anda yakin ingin logout dari aplikasi?',\r\n                icon: 'warning',\r\n                showCancelButton: true,\r\n                confirmButtonText: 'Ya, Logout',\r\n                cancelButtonText: 'Batal',\r\n                reverseButtons: true,\r\n                focusCancel: true,\r\n                showLoaderOnConfirm: true,\r\n                preConfirm: async () => {\r\n                  try {\r\n                    await logout();\r\n                  } catch (e) {\r\n                    Swal.showValidationMessage('Gagal logout. Coba lagi.');\r\n                    throw e;\r\n                  }\r\n                },\r\n                allowOutsideClick: () => !Swal.isLoading(),\r\n              });\r\n\r\n              if (result.isConfirmed) {\r\n                await Swal.fire({\r\n                  title: 'Logout berhasil',\r\n                  icon: 'success',\r\n                  timer: 1000,\r\n                  showConfirmButton: false,\r\n                });\r\n                router.push('/login');\r\n              }\r\n            }}\r\n            className=\"flex items-center gap-2 px-3 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 transition\"\r\n          >\r\n            <LogOut className=\"w-4 h-4\" />\r\n            <span className=\"text-sm\">Logout</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n\r\nfunction AdminSidebar() {\r\n  const pathname = usePathname();\r\n  // Dynamic modules loaded from localStorage (UI only for now)\r\n  type ModuleItem = { id: string | number; title: string; materiCount?: number; quizCount?: number };\r\n  const [modules, setModules] = useState<ModuleItem[]>([]);\r\n  const [openModules, setOpenModules] = useState<Record<string, boolean>>({});\r\n  const MODULES_STORAGE_KEY = 'admin_modules';\r\n\r\n  // normalize path (remove trailing slash) and determine active state\r\n  const normalize = (p?: string) => (p || \"\").replace(/\\/+$/, \"\");\r\n  const isActive = (href: string) => {\r\n    const current = normalize(pathname);\r\n    const target = normalize(href);\r\n    // make the root admin link active only on exact '/'\r\n    if (target === \"/\") return current === \"/\";\r\n    return current.startsWith(target);\r\n  };\r\n\r\n  const itemBase =\r\n    \"flex items-center gap-3 px-3 py-2 rounded-md transition-colors duration-150\";\r\n  const itemActive = \"bg-white/10 text-white\";\r\n  const itemHover = \"hover:bg-white/6\";\r\n\r\n  // Load modules from backend (preferred) with fallback to localStorage; subscribe to changes\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      // Try backend first\r\n      try {\r\n        const res = await adminModulesApi.list();\r\n        if (res.ok) {\r\n          const dataAny = res.data as unknown as ModuleItem[] | { items?: ModuleItem[]; data?: ModuleItem[] };\r\n          const items = Array.isArray(dataAny) ? dataAny : ((dataAny.items || dataAny.data || []) as ModuleItem[]);\r\n          if (items && Array.isArray(items)) {\r\n            setModules(items);\r\n            try {\r\n              localStorage.setItem(MODULES_STORAGE_KEY, JSON.stringify(items));\r\n            } catch { /* ignore */ }\r\n            return;\r\n          }\r\n        }\r\n      } catch {\r\n        // ignore and fallback\r\n      }\r\n\r\n      // Fallback to localStorage\r\n      try {\r\n        const raw = typeof window !== 'undefined' ? localStorage.getItem(MODULES_STORAGE_KEY) : null;\r\n        if (raw) {\r\n          const parsed = JSON.parse(raw) as ModuleItem[];\r\n          setModules(parsed);\r\n          return;\r\n        }\r\n      } catch { /* ignore */ }\r\n\r\n      // Seed when nothing available\r\n      const seed: ModuleItem[] = [\r\n        { id: \"bayi-balita\", title: \"Bayi & Balita\", materiCount: 12, quizCount: 6 },\r\n        { id: \"remaja-sekolah\", title: \"Usia Sekolah & Remaja\", materiCount: 9, quizCount: 4 },\r\n        { id: \"hamil-menyusui\", title: \"Ibu Hamil & Menyusui\", materiCount: 8, quizCount: 5 },\r\n        { id: \"dewasa-lansia\", title: \"Dewasa & Lansia\", materiCount: 10, quizCount: 7 }\r\n      ];\r\n      setModules(seed);\r\n    };\r\n\r\n    load();\r\n    const onStorage = (e: StorageEvent) => {\r\n      if (e.key === MODULES_STORAGE_KEY) load();\r\n    };\r\n    const onCustom = () => load();\r\n    window.addEventListener('storage', onStorage);\r\n    window.addEventListener('modules:updated', onCustom as EventListener);\r\n    return () => {\r\n      window.removeEventListener('storage', onStorage);\r\n      window.removeEventListener('modules:updated', onCustom as EventListener);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <aside className=\"fixed left-0 top-0 w-80 bg-gradient-to-t from-[#27548A] to-[#1C3C6D] text-slate-100 shadow-lg min-h-screen flex flex-col z-40\">\r\n      <div className=\"h-20 flex items-center justify-center bg-gradient-to-r from-[#27548A] to-[#1C3C6D] border-b border-white/10\">\r\n        <Image\r\n          src=\"/logo-putih.svg\"\r\n          alt=\"Bukadita Logo\"\r\n          width={60}\r\n          height={30}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"p-4 pt-6 flex-1 overflow-auto\">\r\n        <nav className=\"space-y-3\">\r\n          <Link\r\n            href=\"/admin/dashboard\"\r\n            className={`${itemBase} ${isActive(\"/admin/dashboard\") ? itemActive : itemHover\r\n              }`}\r\n          >\r\n            <ChartPie className=\"w-5 h-5 opacity-90\" />\r\n            <span className=\"font-medium\">Dashboard</span>\r\n          </Link>\r\n\r\n          <Link\r\n            href=\"/admin/kelola-pengguna\"\r\n            className={`${itemBase} ${isActive(\"/admin/kelola-pengguna\") ? itemActive : itemHover\r\n              }`}\r\n          >\r\n            <Users className=\"w-5 h-5 opacity-90\" />\r\n            <span className=\"font-medium\">Kelola Pengguna</span>\r\n          </Link>\r\n\r\n          <Link\r\n            href=\"/admin/kelola-modul\"\r\n            className={`${itemBase} ${isActive(\"/admin/kelola-modul\") ? itemActive : itemHover}`}\r\n          >\r\n            <Folder className=\"w-5 h-5 opacity-90\" />\r\n            <span className=\"font-medium\">Kelola Modul</span>\r\n          </Link>\r\n\r\n          <Link\r\n            href=\"/admin/progress\"\r\n            className={`${itemBase} ${isActive(\"/admin/progress\") ? itemActive : itemHover}`}\r\n          >\r\n            <TrendingUp className=\"w-5 h-5 opacity-90\" />\r\n            <span className=\"font-medium\">Progress & Attempts</span>\r\n          </Link>\r\n\r\n          {/* Dynamic Modules Section */}\r\n          <div className=\"pt-4\">\r\n            <div className=\"flex items-start px-3 py-2\">\r\n              <p className=\"text-md font-semibold text-slate-100\">MODUL</p>\r\n            </div>\r\n\r\n            <div className=\"mt-1\">\r\n              {modules.map((m) => {\r\n                const open = openModules[m.id] ?? false;\r\n                return (\r\n                  <div key={m.id} className=\"mb-1\">\r\n                    <button\r\n                      onClick={() => setOpenModules((prev) => ({ ...prev, [m.id]: !open }))}\r\n                      className=\"w-full flex items-center justify-between px-3 py-2 rounded-md hover:bg-white/6\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className={`w-6 h-6 rounded-md bg-gradient-to-br grid place-items-center`}>\r\n                          <Folder className=\"w-5 h-5 text-white\" />\r\n                        </div>\r\n                        <span className=\"font-medium text-slate-100 truncate\" title={m.title}>{m.title}</span>\r\n                      </div>\r\n                      <span className=\"ml-2 flex items-center gap-2 text-xs text-slate-300\">\r\n                        {/* {typeof m.materiCount === 'number' && <span className=\"bg-white/10 px-2 py-0.5 rounded-full\">{m.materiCount} Materi</span>} */}\r\n                        {/* {typeof m.quizCount === 'number' && <span className=\"bg-white/10 px-2 py-0.5 rounded-full\">{m.quizCount} Kuis</span>} */}\r\n                        {open ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronRight className=\"w-4 h-4\" />}\r\n                      </span>\r\n                    </button>\r\n\r\n                    {open && (\r\n                      <div className=\"mt-1 pl-6 flex flex-col gap-1\">\r\n                        <Link\r\n                          href={`/admin/modul/${encodeURIComponent(m.id)}/materi`}\r\n                          className={`${itemBase} text-slate-100 text-sm ${isActive(`/admin/modul/${m.id}/materi`) ? itemActive : itemHover}`}\r\n                        >\r\n                          <BookOpen className=\"w-4 h-4 opacity-80\" />\r\n                          <span>Materi</span>\r\n                        </Link>\r\n                        <Link\r\n                          href={`/admin/modul/${encodeURIComponent(m.id)}/kuis`}\r\n                          className={`${itemBase} text-slate-100 text-sm ${isActive(`/admin/modul/${m.id}/kuis`) ? itemActive : itemHover}`}\r\n                        >\r\n                          <ListChecks className=\"w-4 h-4 opacity-80\" />\r\n                          <span>Kuis</span>\r\n                        </Link>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </nav>\r\n      </div>\r\n    </aside>\r\n  );\r\n}\r\n\r\nfunction AdminLayoutContent({ children }: { children: ReactNode }) {\r\n  const pathname = usePathname();\r\n  const router = useRouter();\r\n  const { isAuthenticated, profile, isLoading } = useAuth();\r\n\r\n  // Client-side guard: redirect unauthenticated access to /admin/** to /login\r\n  useEffect(() => {\r\n    if (!pathname) return;\r\n    const onAdmin = pathname.startsWith('/admin');\r\n    if (onAdmin && !isLoading && !isAuthenticated) {\r\n      router.push('/login');\r\n    }\r\n  }, [pathname, isAuthenticated, isLoading, router]);\r\n\r\n  // Redirect known non-admin away from /admin/**\r\n  useEffect(() => {\r\n    if (\r\n      pathname?.startsWith('/admin') &&\r\n      isAuthenticated &&\r\n      profile &&\r\n      !(profile.role === 'admin' || profile.role === 'superadmin')\r\n    ) {\r\n      router.push('/login');\r\n    }\r\n  }, [pathname, isAuthenticated, profile, router]);\r\n\r\n  // If on login or register page, render children without admin chrome\r\n  if (pathname === '/login' || pathname === '/register') {\r\n    return <>{children}</>;\r\n  }\r\n\r\n  // While auth state is loading, avoid rendering admin chrome to prevent flicker\r\n  if (isLoading && pathname?.startsWith('/admin')) {\r\n    return (\r\n      <div className=\"min-h-screen grid place-items-center bg-gray-50\">\r\n        <div className=\"text-slate-500 text-sm\">Memuat sesi...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <AdminSidebar />\r\n      <AdminHeader />\r\n      <main className=\"ml-80 pt-20 h-screen max-w-none overflow-y-auto overflow-x-hidden p-6\">\r\n        {children}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function AdminShell({ children }: AdminShellProps) {\r\n  return (\r\n    <AuthProvider>\r\n      <AdminLayoutContent>{children}</AdminLayoutContent>\r\n    </AuthProvider>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1419, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus%20TUF%20Gaming/Documents/KULIAH/Pengabdian%20Website%20Posyandu/bukadita_backoffice/src/components/ui/toast.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useState, ReactNode } from \"react\";\r\n\r\ntype Toast = { id: number; title?: string; description?: string };\r\n\r\nconst ToastContext = createContext<{\r\n  toasts: Toast[];\r\n  show: (t: Omit<Toast, \"id\">) => void;\r\n  remove: (id: number) => void;\r\n} | null>(null);\r\n\r\nexport function ToastProvider({ children }: { children: ReactNode }) {\r\n  const [toasts, setToasts] = useState<Toast[]>([]);\r\n  const show = (t: Omit<Toast, \"id\">) => {\r\n    const id = Date.now();\r\n    setToasts((prev) => [...prev, { id, ...t }]);\r\n    setTimeout(() => remove(id), 3000);\r\n  };\r\n  const remove = (id: number) => setToasts((prev) => prev.filter((x) => x.id !== id));\r\n  return (\r\n    <ToastContext.Provider value={{ toasts, show, remove }}>\r\n      {children}\r\n      <div className=\"fixed bottom-4 right-4 space-y-2 z-50\">\r\n        {toasts.map((t) => (\r\n          <div key={t.id} className=\"bg-slate-900 text-white rounded px-4 py-2 shadow\">\r\n            {t.title && <div className=\"font-semibold\">{t.title}</div>}\r\n            {t.description && <div className=\"text-sm opacity-90\">{t.description}</div>}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </ToastContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useToast() {\r\n  const ctx = useContext(ToastContext);\r\n  if (!ctx) throw new Error(\"useToast must be used within ToastProvider\");\r\n  return ctx;\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAMA,MAAM,6BAAe,IAAA,6PAAa,EAIxB;AAEH,SAAS,cAAc,KAAqC;QAArC,EAAE,QAAQ,EAA2B,GAArC;;IAC5B,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,wPAAQ,EAAU,EAAE;IAChD,MAAM,OAAO,CAAC;QACZ,MAAM,KAAK,KAAK,GAAG;QACnB,UAAU,CAAC,OAAS;mBAAI;gBAAM;oBAAE;oBAAI,GAAG,CAAC;gBAAC;aAAE;QAC3C,WAAW,IAAM,OAAO,KAAK;IAC/B;IACA,MAAM,SAAS,CAAC,KAAe,UAAU,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAC/E,qBACE,4QAAC,aAAa,QAAQ;QAAC,OAAO;YAAE;YAAQ;YAAM;QAAO;;YAClD;0BACD,4QAAC;gBAAI,WAAU;0BACZ,OAAO,GAAG,CAAC,CAAC,kBACX,4QAAC;wBAAe,WAAU;;4BACvB,EAAE,KAAK,kBAAI,4QAAC;gCAAI,WAAU;0CAAiB,EAAE,KAAK;;;;;;4BAClD,EAAE,WAAW,kBAAI,4QAAC;gCAAI,WAAU;0CAAsB,EAAE,WAAW;;;;;;;uBAF5D,EAAE,EAAE;;;;;;;;;;;;;;;;AAQxB;GArBgB;KAAA;AAuBT,SAAS;;IACd,MAAM,MAAM,IAAA,0PAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;IAJgB","debugId":null}}]
}