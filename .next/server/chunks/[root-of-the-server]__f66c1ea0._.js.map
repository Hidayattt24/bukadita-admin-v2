{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus%20TUF%20Gaming/Documents/KULIAH/Pengabdian%20Website%20Posyandu/bukadita_backoffice/src/app/api/auth/session/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL as string;\r\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY as string;\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const userId: string | undefined = body?.userId;\r\n    const roleFromClient: string | undefined = body?.role;\r\n\r\n    let role = roleFromClient;\r\n\r\n    if (!role && userId) {\r\n      const supabase = createClient(supabaseUrl, serviceRoleKey, {\r\n        auth: { persistSession: false },\r\n      });\r\n      const { data: profile } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, role\")\r\n        .eq(\"id\", userId)\r\n        .single();\r\n      role = profile?.role;\r\n    }\r\n\r\n    const isProd = process.env.NODE_ENV === \"production\";\r\n    const isAdminLevel = role === \"admin\" || role === \"superadmin\";\r\n    const isAuthed = Boolean(userId) || isAdminLevel;\r\n\r\n    const res = NextResponse.json({ ok: true, role: role || null });\r\n    res.cookies.set(\"admin_auth\", isAuthed ? \"1\" : \"0\", {\r\n      httpOnly: true,\r\n      path: \"/\",\r\n      sameSite: \"lax\",\r\n      secure: isProd,\r\n      maxAge: 60 * 60 * 12,\r\n    });\r\n    res.cookies.set(\"admin_role\", role || \"\", {\r\n      httpOnly: true,\r\n      path: \"/\",\r\n      sameSite: \"lax\",\r\n      secure: isProd,\r\n      maxAge: 60 * 60 * 12,\r\n    });\r\n    return res;\r\n  } catch (err: unknown) {\r\n    const message = err instanceof Error ? err.message : \"Unexpected error\";\r\n    return NextResponse.json({ error: message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const role = req.cookies.get(\"admin_role\")?.value || \"\";\r\n    const authed = req.cookies.get(\"admin_auth\")?.value === \"1\";\r\n    return NextResponse.json({ ok: true, authed, role });\r\n  } catch (err: unknown) {\r\n    const message = err instanceof Error ? err.message : \"Unexpected error\";\r\n    return NextResponse.json({ error: message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAErD,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,SAA6B,MAAM;QACzC,MAAM,iBAAqC,MAAM;QAEjD,IAAI,OAAO;QAEX,IAAI,CAAC,QAAQ,QAAQ;YACnB,MAAM,WAAW,IAAA,wRAAY,EAAC,aAAa,gBAAgB;gBACzD,MAAM;oBAAE,gBAAgB;gBAAM;YAChC;YACA,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM,QACT,MAAM;YACT,OAAO,SAAS;QAClB;QAEA,MAAM,SAAS,oDAAyB;QACxC,MAAM,eAAe,SAAS,WAAW,SAAS;QAClD,MAAM,WAAW,QAAQ,WAAW;QAEpC,MAAM,MAAM,+NAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,MAAM,QAAQ;QAAK;QAC7D,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,WAAW,MAAM,KAAK;YAClD,UAAU;YACV,MAAM;YACN,UAAU;YACV,QAAQ;YACR,QAAQ,KAAK,KAAK;QACpB;QACA,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,QAAQ,IAAI;YACxC,UAAU;YACV,MAAM;YACN,UAAU;YACV,QAAQ;YACR,QAAQ,KAAK,KAAK;QACpB;QACA,OAAO;IACT,EAAE,OAAO,KAAc;QACrB,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;QACrD,OAAO,+NAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC7D;AACF;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,SAAS;QACrD,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,UAAU;QACxD,OAAO,+NAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM;YAAQ;QAAK;IACpD,EAAE,OAAO,KAAc;QACrB,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;QACrD,OAAO,+NAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC7D;AACF","debugId":null}}]
}